# Сервис для работы с ПВЗ

Данный сервис разработан для управления пунктами выдачи заказов (Работа с приемками и продуктами в ПВЗ).

Сервис позволяет:
* Зарегистрировать пользователя в системе. Доступно несколько ролей (модератор, сотрудник)
* Создать ПВЗ с привязкой к городу (доступно модератору). Варианты городов находятся в базе
* Инициировать и завершить приемку товара в указанном ПВЗ (доступно сотруднику)
* Добавлять и удалять товары в рамках приемки указанного ПВЗ (доступно сотруднику). Варианты типов товара находятся в базе
* Получать полную информацию о ПВЗ, включая приемки с продуктами, с возможностью фильтровать по дате приемки (доступно модератору и сотруднику)

## Реализованный функционал / требования

### Основной:
* ✅ Авторизация с dummyLogin
* ✅ Соответствует нефункциональным требованиям (RPS — 1000, SLI времени ответа — 100 мс, SLI успешности ответа — 99.99%). Проверено при нагрузочном тесте k6
* ✅ Код покрыт unit-тестами, а также реализован интеграционный тест
* ✅ Базой данных выбран PostgreSQL
* ✅ Сервис обернут в контейнер с использованием Docker Compose

 ### Дополнительный:
 * ✅ Регистрация и авторизация через register и login
 * ✅ Настроен логер
 * ✅ Используется кодогенерация DTO из swagger.yaml для всех поинтов
 * ✅ Добавлены миграции базы данных для упрощения работы
 * ✅ Добавлен Swagger UI для упрощения использования

## Структура проекта

* `api/`: Информация о API.
    * `generated/`: Сгенерированный DTO для API.
    * `spec/`: OpenAPI спецификация.
    * `swagger/`: Swagger UI для работы из браузера.
* `cmd/pvz-service/main.go`: Точка входа в приложение
* `config/`: Файлы конфигурации проекта.
* `internal/`: Основная логика приложения.
    * `app/`: Запуск серверов приложения
    * `config/`: Загрузка конфигурации из файла или окружения
    * `controller/`: Все для работы серверов приложения (handler, router, middleware)
    * `errors/`: Общие файлы с различными ошибками
    * `logger/`: Логер приложения
    * `metrics/`: Определение и регистрация метрик Prometheus (планируется)
    * `models/`: Структуры данных, используемые в приложении (User, PVZ, Reception, Product и т.д.)
    * `repository/`: Репозитории для взаимодействия с хранилищами данных
    * `service/`: Сервисы приложения с основной бизнес-логикой
* `Dockerfile`: 
* `docker-compose.yml`: 

## Запуск

Для запуска понадобятся **Docker** и **Docker Compose**.

1.  **Склонируйте проект локально:**
    ```
    git clone https://github.com/R0st0k/PVZ_Service.git
    ```
2.  **В корне проекта введите команду:**
    ```
    docker compose up --build
    ```

Сервисы будут доступны по следующим портам:
* **HTTP API:** `http://localhost:8080`
* **Swagger:** `http://localhost:8080/swagger/`

## Остановка

Для остановки введите команду:
```
docker compose down
```

Также можно добавить флаг ```-v``` в конце команды для очистки ```docker volume```

## Кодогенерация

Весь необходимый сгенерированный код уже **присутствует** в репозитории (api/generated/types.gen.go). Если вы хотите проверить процесс генерации вы можете перегенерировать код:

1. Проверьте, что у Вас установлен [oapi-codegen](https://github.com/oapi-codegen/oapi-codegen)
2. В корне проекта используйте команду:
   ```bash
   go generate ./...
   ```

## Тестирование

Для запуска тестов в корне проекта введите команду:
```bash
go test ./...
```

## Заметки
Возникшие вопросы и мои решения:
---
### Вопрос
В задании упоминается название одной из роли Client и Employee
### Решение
Выбран Employee с опорой на OpenAPI Spec и бизнес-логики (это сервис для внутренней работы ПВЗ, все пользователи являются его сотрудниками, а не клиентами)

---

### Вопрос
В текстовом задании описывается пагинация запроса информации о всех ПВЗ. Исходя из текста, пагинация рассчитана на уровень ПВЗ, но внутренняя информация в объеме не контролируется. Исходя из бизнес-логики использования web-приложения, на странице логично было бы ограничивать количество отображаемых продуктов, чтобы выводимая таблица не меняла размер от страницы к странице
### Решение
Выбран вариант пагинации на уровне ПВЗ, поскольку текст и OpenAPI Spec демонстрируют направленность на просмотр ПВЗ, а не продуктов

---

### P.S.
В ближайшее время добавлю grpc сервер и prometheus метрики. Это не является сложным заданием, просто, к своему сожалению, я заболел и не уложился в свои сроки.
 
